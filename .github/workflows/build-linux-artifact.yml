name: Build osu! for Linux (Desktop Only)

on:
  workflow_dispatch:
  push:
    branches:
      - main
      - master
  pull_request:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ§¾ Checkout repo
        uses: actions/checkout@v3

      - name: ğŸ§° Set up .NET 8
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '8.x'

      - name: ğŸ§¼ Clean build leftovers
        run: dotnet clean osu.Desktop/osu.Desktop.csproj -c Release
      
      - name: piss off
        run: sh ./UseLocalResources.sh
        
      - name: ğŸ› ï¸ Restore only osu.Desktop
        run: dotnet restore osu.Desktop/osu.Desktop.csproj

      - name: ğŸ—ï¸ Build osu.Desktop for Linux only
        run: |
          dotnet publish osu.Desktop/osu.Desktop.csproj \
            -c Release \
            -f net8.0 \
            -r linux-x64 \
            --self-contained false \
            -o build

      - name: ğŸ“¦ Zip build output
        run: zip -r osu-linux-build.zip build/

      - name: â¬†ï¸ Upload build artifact
        uses: actions/upload-artifact@v4
        with:
          name: osu.Desktop-linux
          path: osu-linux-build.zip
